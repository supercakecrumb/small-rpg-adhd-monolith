{{define "content"}}
<div class="dashboard">
    <div class="page-header">
        <h2>üßÄ Welcome to the Burrow, {{.Username}}!</h2>
    </div>

    {{if .Error}}
    <div class="alert alert-error">{{.Error}}</div>
    {{end}}

    <div class="card">
        <div class="card-header-with-tooltip">
            <h3>Your Parties</h3>
            <button class="info-tooltip-trigger" aria-label="Info about parties">
                <span class="info-icon">‚ìò</span>
                <span class="info-tooltip">Parties are shared quest boards for you and others</span>
            </button>
        </div>
        
        {{if .Groups}}
        <div class="groups-grid">
            {{range .Groups}}
            <a href="/groups/{{.ID}}" class="group-card">
                <h4>{{.Name}}</h4>
                <p class="text-muted">Invite Code: <code>{{.InviteCode}}</code></p>
            </a>
            {{end}}
        </div>
        {{else}}
        <p class="empty-state">You're not in any parties yet. Create one or join using an invite code!</p>
        {{end}}
    </div>

    <div class="actions-grid">
        <div class="card">
            <h3>‚ûï Create New Party</h3>
            <form method="POST" action="/groups/create" class="form">
                <div class="form-group">
                    <label for="name">Party Name</label>
                    <input type="text" id="name" name="name" required 
                           placeholder="e.g., Cozy Quest Crew">
                </div>
                <button type="submit" class="btn btn-primary">Create Party</button>
            </form>
        </div>

        <div class="card">
            <h3>üîó Join Party</h3>
            <form method="POST" action="/groups/join" class="form">
                <div class="form-group">
                    <label for="invite_code">Invite Code</label>
                    <input type="text" id="invite_code" name="invite_code" required 
                           placeholder="Enter invite code">
                </div>
                <button type="submit" class="btn btn-secondary">Join Party</button>
            </form>
        </div>
    </div>

    <div class="card edu-section collapsed">
        <button class="edu-main-toggle" onclick="toggleMainSection(this)">
            <span class="toggle-icon">üîÆ</span>
            <span class="toggle-text">How the Burrow Works</span>
            <span class="toggle-hint">(click to expand)</span>
            <span class="toggle-arrow">‚ñº</span>
        </button>
        
        <div class="edu-content">
            <div class="edu-flow-container">
                <div class="collapsible-step-card">
                    <button class="step-toggle" onclick="toggleStep(this)">
                        <div class="step-toggle-header">
                            <div class="edu-icon-large">üß≠</div>
                            <span class="step-title">Create Quest</span>
                            <span class="step-arrow">‚ñº</span>
                        </div>
                    </button>
                    <div class="step-content">
                        <p>Small actions‚Äîpick one-and-done or countable progress. Start with something that feels manageable and build momentum.</p>
                    </div>
                </div>
                
                <div class="flow-arrow-between">‚Üí</div>
                
                <div class="collapsible-step-card">
                    <button class="step-toggle" onclick="toggleStep(this)">
                        <div class="step-toggle-header">
                            <div class="edu-icon-large">‚úÖ</div>
                            <span class="step-title">Complete Quest</span>
                            <span class="step-arrow">‚ñº</span>
                        </div>
                    </button>
                    <div class="step-content">
                        <p>Mark your quest as complete when you finish it. Every completion counts and builds your progress!</p>
                    </div>
                </div>
                
                <div class="flow-arrow-between">‚Üí</div>
                
                <div class="collapsible-step-card">
                    <button class="step-toggle" onclick="toggleStep(this)">
                        <div class="step-toggle-header">
                            <div class="edu-icon-large">üßÄ</div>
                            <span class="step-title">Earn Coins</span>
                            <span class="step-arrow">‚ñº</span>
                        </div>
                    </button>
                    <div class="step-content">
                        <p>Get cheese coins for your effort. The reward system stays gentle‚Äîit's about progress, not perfection.</p>
                    </div>
                </div>
                
                <div class="flow-arrow-between">‚Üí</div>
                
                <div class="collapsible-step-card">
                    <button class="step-toggle" onclick="toggleStep(this)">
                        <div class="step-toggle-header">
                            <div class="edu-icon-large">üõçÔ∏è</div>
                            <span class="step-title">Buy Rewards</span>
                            <span class="step-arrow">‚ñº</span>
                        </div>
                    </button>
                    <div class="step-content">
                        <p>Swap your coins for treats you choose. Create rewards that motivate you and celebrate your wins!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleMainSection(button) {
    const section = button.closest('.edu-section');
    const content = section.querySelector('.edu-content');
    const arrow = button.querySelector('.toggle-arrow');
    const hint = button.querySelector('.toggle-hint');
    
    section.classList.toggle('collapsed');
    
    if (section.classList.contains('collapsed')) {
        arrow.textContent = '‚ñº';
        hint.textContent = '(click to expand)';
    } else {
        arrow.textContent = '‚ñ≤';
        hint.textContent = '(click to collapse)';
    }
}

function toggleStep(button) {
    const card = button.closest('.collapsible-step-card');
    const content = card.querySelector('.step-content');
    const arrow = button.querySelector('.step-arrow');
    
    card.classList.toggle('expanded');
    
    if (card.classList.contains('expanded')) {
        arrow.textContent = '‚ñ≤';
    } else {
        arrow.textContent = '‚ñº';
    }
}
</script>
</div>
{{end}}
